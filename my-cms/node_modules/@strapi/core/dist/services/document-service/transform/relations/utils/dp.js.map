{"version":3,"file":"dp.js","sources":["../../../../../../src/services/document-service/transform/relations/utils/dp.ts"],"sourcesContent":["import { isNil } from 'lodash/fp';\n\nimport { contentTypes } from '@strapi/utils';\nimport { UID } from '@strapi/types';\n\nimport { LongHandDocument } from './types';\n\ntype Status = 'draft' | 'published';\n\nexport const getRelationTargetStatus = (\n  relation: Pick<LongHandDocument, 'documentId' | 'status'>,\n  opts: {\n    targetUid: UID.Schema;\n    sourceUid: UID.Schema;\n    sourceStatus?: Status;\n  }\n): Status[] => {\n  // Ignore if the target content type does not have draft and publish enabled\n  const targetContentType = strapi.getModel(opts.targetUid);\n  const sourceContentType = strapi.getModel(opts.sourceUid);\n\n  const targetHasDP = contentTypes.hasDraftAndPublish(targetContentType);\n  const sourceHasDP = contentTypes.hasDraftAndPublish(sourceContentType);\n\n  if (!targetHasDP) {\n    return ['published'];\n  }\n\n  /**\n   * If both source and target have DP enabled,\n   * connect it to the same status as the source status\n   */\n  if (sourceHasDP && !isNil(opts.sourceStatus)) {\n    return [opts.sourceStatus];\n  }\n\n  /**\n   * Use the status from the relation if it's set\n   */\n  if (relation.status) {\n    switch (relation.status) {\n      case 'published':\n        return ['published'];\n      default:\n        // Default to draft if it's an invalid status (e.g. modified)\n        return ['draft'];\n    }\n  }\n\n  /**\n   * If DP is disabled and relation does not specify any status\n   * Connect to both draft and published versions\n   */\n  if (!sourceHasDP) {\n    return ['draft', 'published'];\n  }\n\n  // Default to draft as a fallback\n  return ['draft'];\n};\n"],"names":["contentTypes","isNil"],"mappings":";;;;AASa,MAAA,0BAA0B,CACrC,UACA,SAKa;AAEb,QAAM,oBAAoB,OAAO,SAAS,KAAK,SAAS;AACxD,QAAM,oBAAoB,OAAO,SAAS,KAAK,SAAS;AAElD,QAAA,cAAcA,YAAAA,aAAa,mBAAmB,iBAAiB;AAC/D,QAAA,cAAcA,YAAAA,aAAa,mBAAmB,iBAAiB;AAErE,MAAI,CAAC,aAAa;AAChB,WAAO,CAAC,WAAW;AAAA,EAAA;AAOrB,MAAI,eAAe,CAACC,GAAAA,MAAM,KAAK,YAAY,GAAG;AACrC,WAAA,CAAC,KAAK,YAAY;AAAA,EAAA;AAM3B,MAAI,SAAS,QAAQ;AACnB,YAAQ,SAAS,QAAQ;AAAA,MACvB,KAAK;AACH,eAAO,CAAC,WAAW;AAAA,MACrB;AAEE,eAAO,CAAC,OAAO;AAAA,IAAA;AAAA,EACnB;AAOF,MAAI,CAAC,aAAa;AACT,WAAA,CAAC,SAAS,WAAW;AAAA,EAAA;AAI9B,SAAO,CAAC,OAAO;AACjB;;"}