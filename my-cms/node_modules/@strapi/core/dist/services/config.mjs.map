{"version":3,"file":"config.mjs","sources":["../../src/services/config.ts"],"sourcesContent":["import type { Core } from '@strapi/types';\nimport { get, set, has, isString, isNumber, isArray, type PropertyPath } from 'lodash';\n\ntype State = {\n  config: Config;\n};\n\ntype Config = Record<string, unknown>;\n\nexport const createConfigProvider = (\n  initialConfig: Record<string, unknown> = {},\n  strapi?: Core.Strapi\n): Core.ConfigProvider => {\n  const state: State = {\n    config: { ...initialConfig }, // not deep clone because it would break some config\n  };\n\n  // Accessing model configs with dot (.) was deprecated between v4->v5, but to avoid a major breaking change\n  // we will still support certain namespaces, currently only 'plugin.'\n  const transformPathString = (path: string) => {\n    if (path.startsWith('plugin.')) {\n      const newPath = path.replace('plugin.', 'plugin::');\n\n      // strapi logger may not be loaded yet, so fall back to console\n      (strapi?.log?.warn ?? console.warn)(\n        `Using dot notation for model config namespaces is deprecated, for example \"plugin::myplugin\" should be used instead of \"plugin.myplugin\". Modifying requested path ${path} to ${newPath}`\n      );\n      return newPath;\n    }\n\n    return path;\n  };\n\n  const transformDeprecatedPaths = (path: PropertyPath): PropertyPath => {\n    if (isString(path)) {\n      return transformPathString(path);\n    }\n    if (isArray(path)) {\n      // if the path is not joinable, we won't apply our deprecation support\n      if (path.some((part) => !(isString(part) || isNumber(part)))) {\n        return path;\n      }\n\n      return transformPathString(path.join('.'));\n    }\n\n    return path;\n  };\n\n  return {\n    ...state.config, // TODO: to remove\n    get(path: PropertyPath, defaultValue?: unknown) {\n      return get(state.config, transformDeprecatedPaths(path), defaultValue);\n    },\n    set(path: PropertyPath, val: unknown) {\n      set(state.config, transformDeprecatedPaths(path), val);\n      return this;\n    },\n    has(path: PropertyPath) {\n      return has(state.config, transformDeprecatedPaths(path));\n    },\n  };\n};\n"],"names":[],"mappings":";AASO,MAAM,uBAAuB,CAClC,gBAAyC,IACzC,WACwB;AACxB,QAAM,QAAe;AAAA,IACnB,QAAQ,EAAE,GAAG,cAAc;AAAA;AAAA,EAC7B;AAIM,QAAA,sBAAsB,CAAC,SAAiB;AACxC,QAAA,KAAK,WAAW,SAAS,GAAG;AAC9B,YAAM,UAAU,KAAK,QAAQ,WAAW,UAAU;AAGjD,OAAA,QAAQ,KAAK,QAAQ,QAAQ;AAAA,QAC5B,sKAAsK,IAAI,OAAO,OAAO;AAAA,MAC1L;AACO,aAAA;AAAA,IAAA;AAGF,WAAA;AAAA,EACT;AAEM,QAAA,2BAA2B,CAAC,SAAqC;AACjE,QAAA,SAAS,IAAI,GAAG;AAClB,aAAO,oBAAoB,IAAI;AAAA,IAAA;AAE7B,QAAA,QAAQ,IAAI,GAAG;AAEb,UAAA,KAAK,KAAK,CAAC,SAAS,EAAE,SAAS,IAAI,KAAK,SAAS,IAAI,EAAE,GAAG;AACrD,eAAA;AAAA,MAAA;AAGT,aAAO,oBAAoB,KAAK,KAAK,GAAG,CAAC;AAAA,IAAA;AAGpC,WAAA;AAAA,EACT;AAEO,SAAA;AAAA,IACL,GAAG,MAAM;AAAA;AAAA,IACT,IAAI,MAAoB,cAAwB;AAC9C,aAAO,IAAI,MAAM,QAAQ,yBAAyB,IAAI,GAAG,YAAY;AAAA,IACvE;AAAA,IACA,IAAI,MAAoB,KAAc;AACpC,UAAI,MAAM,QAAQ,yBAAyB,IAAI,GAAG,GAAG;AAC9C,aAAA;AAAA,IACT;AAAA,IACA,IAAI,MAAoB;AACtB,aAAO,IAAI,MAAM,QAAQ,yBAAyB,IAAI,CAAC;AAAA,IAAA;AAAA,EAE3D;AACF;"}