{"version":3,"file":"rate-limiter.mjs","sources":["../../../src/services/metrics/rate-limiter.ts"],"sourcesContent":["import type { Sender } from './sender';\n\ninterface Options {\n  limitedEvents?: string[];\n}\n\ntype TailParams<T extends (...args: any[]) => any> =\n  Parameters<T> extends [unknown, ...infer U] ? U : never;\n\nexport default (sender: Sender, { limitedEvents = [] }: Options = {}) => {\n  let currentDay = new Date().getDate();\n  const eventCache = new Map();\n\n  return async (event: string, ...args: TailParams<Sender>) => {\n    if (!limitedEvents.includes(event)) {\n      return sender(event, ...args);\n    }\n\n    if (new Date().getDate() !== currentDay) {\n      eventCache.clear();\n      currentDay = new Date().getDate();\n    }\n\n    if (eventCache.has(event)) {\n      return false;\n    }\n\n    eventCache.set(event, true);\n    return sender(event, ...args);\n  };\n};\n"],"names":[],"mappings":"AASA,MAAe,oBAAA,CAAC,QAAgB,EAAE,gBAAgB,CAAG,EAAA,IAAa,CAAA,MAAO;AACvE,MAAI,cAAa,oBAAI,KAAK,GAAE,QAAQ;AAC9B,QAAA,iCAAiB,IAAI;AAEpB,SAAA,OAAO,UAAkB,SAA6B;AAC3D,QAAI,CAAC,cAAc,SAAS,KAAK,GAAG;AAC3B,aAAA,OAAO,OAAO,GAAG,IAAI;AAAA,IAAA;AAG9B,SAAQ,oBAAA,KAAA,GAAO,QAAA,MAAc,YAAY;AACvC,iBAAW,MAAM;AACJ,oBAAA,oBAAI,KAAK,GAAE,QAAQ;AAAA,IAAA;AAG9B,QAAA,WAAW,IAAI,KAAK,GAAG;AAClB,aAAA;AAAA,IAAA;AAGE,eAAA,IAAI,OAAO,IAAI;AACnB,WAAA,OAAO,OAAO,GAAG,IAAI;AAAA,EAC9B;AACF;"}