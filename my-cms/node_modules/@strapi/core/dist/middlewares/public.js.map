{"version":3,"file":"public.js","sources":["../../src/middlewares/public.ts"],"sourcesContent":["import { defaultsDeep } from 'lodash/fp';\nimport koaStatic from 'koa-static';\nimport type { Core } from '@strapi/types';\n\ntype Config = koaStatic.Options;\n\nconst defaults = {\n  maxAge: 60000,\n};\n\nexport const publicStatic: Core.MiddlewareFactory = (\n  config: Config,\n  { strapi }: { strapi: Core.Strapi }\n) => {\n  const { maxAge } = defaultsDeep(defaults, config);\n\n  strapi.server.routes([\n    {\n      method: 'GET',\n      path: '/',\n      handler(ctx) {\n        ctx.redirect(strapi.config.get('admin.url', '/admin'));\n      },\n      config: { auth: false },\n    },\n    // All other public GET-routes except /uploads/(.*) which is handled in upload middleware\n    {\n      method: 'GET',\n      path: '/((?!uploads/).+)',\n      handler: koaStatic(strapi.dirs.static.public, {\n        maxage: maxAge,\n        defer: true,\n      }),\n      config: { auth: false },\n    },\n  ]);\n};\n"],"names":["defaultsDeep","koaStatic"],"mappings":";;;;;;AAMA,MAAM,WAAW;AAAA,EACf,QAAQ;AACV;AAEO,MAAM,eAAuC,CAClD,QACA,EAAE,aACC;AACH,QAAM,EAAE,OAAW,IAAAA,gBAAa,UAAU,MAAM;AAEhD,SAAO,OAAO,OAAO;AAAA,IACnB;AAAA,MACE,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,QAAQ,KAAK;AACX,YAAI,SAAS,OAAO,OAAO,IAAI,aAAa,QAAQ,CAAC;AAAA,MACvD;AAAA,MACA,QAAQ,EAAE,MAAM,MAAM;AAAA,IACxB;AAAA;AAAA,IAEA;AAAA,MACE,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,SAASC,mBAAAA,QAAU,OAAO,KAAK,OAAO,QAAQ;AAAA,QAC5C,QAAQ;AAAA,QACR,OAAO;AAAA,MAAA,CACR;AAAA,MACD,QAAQ,EAAE,MAAM,MAAM;AAAA,IAAA;AAAA,EACxB,CACD;AACH;;"}