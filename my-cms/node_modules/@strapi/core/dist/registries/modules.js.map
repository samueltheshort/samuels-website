{"version":3,"file":"modules.js","sources":["../../src/registries/modules.ts"],"sourcesContent":["import { pickBy, has } from 'lodash/fp';\nimport type { Core } from '@strapi/types';\nimport { createModule, RawModule, Module } from '../domain/module';\n\ntype ModuleMap = { [namespace: string]: Module };\n\nconst modulesRegistry = (strapi: Core.Strapi) => {\n  const modules: ModuleMap = {};\n\n  return {\n    get(namespace: string) {\n      return modules[namespace];\n    },\n    getAll(prefix = '') {\n      return pickBy<ModuleMap>((mod, namespace) => namespace.startsWith(prefix))(modules);\n    },\n    add(namespace: string, rawModule: RawModule) {\n      if (has(namespace, modules)) {\n        throw new Error(`Module ${namespace} has already been registered.`);\n      }\n\n      modules[namespace] = createModule(namespace, rawModule, strapi);\n      modules[namespace].load();\n\n      return modules[namespace];\n    },\n    async bootstrap() {\n      for (const mod of Object.values(modules)) {\n        await mod.bootstrap();\n      }\n    },\n    async register() {\n      for (const mod of Object.values(modules)) {\n        await mod.register();\n      }\n    },\n    async destroy() {\n      for (const mod of Object.values(modules)) {\n        await mod.destroy();\n      }\n    },\n  };\n};\n\nexport default modulesRegistry;\n"],"names":["pickBy","has","createModule"],"mappings":";;;AAMM,MAAA,kBAAkB,CAAC,WAAwB;AAC/C,QAAM,UAAqB,CAAC;AAErB,SAAA;AAAA,IACL,IAAI,WAAmB;AACrB,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAAA,IACA,OAAO,SAAS,IAAI;AACX,aAAAA,GAAA,OAAkB,CAAC,KAAK,cAAc,UAAU,WAAW,MAAM,CAAC,EAAE,OAAO;AAAA,IACpF;AAAA,IACA,IAAI,WAAmB,WAAsB;AACvC,UAAAC,GAAA,IAAI,WAAW,OAAO,GAAG;AAC3B,cAAM,IAAI,MAAM,UAAU,SAAS,+BAA+B;AAAA,MAAA;AAGpE,cAAQ,SAAS,IAAIC,MAAAA,aAAa,WAAW,WAAW,MAAM;AACtD,cAAA,SAAS,EAAE,KAAK;AAExB,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAAA,IACA,MAAM,YAAY;AAChB,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI,UAAU;AAAA,MAAA;AAAA,IAExB;AAAA,IACA,MAAM,WAAW;AACf,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI,SAAS;AAAA,MAAA;AAAA,IAEvB;AAAA,IACA,MAAM,UAAU;AACd,iBAAW,OAAO,OAAO,OAAO,OAAO,GAAG;AACxC,cAAM,IAAI,QAAQ;AAAA,MAAA;AAAA,IACpB;AAAA,EAEJ;AACF;;"}