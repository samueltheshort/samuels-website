{"version":3,"file":"registries.mjs","sources":["../../src/providers/registries.ts"],"sourcesContent":["import { hooks } from '@strapi/utils';\n\nimport { defineProvider } from './provider';\nimport * as registries from '../registries';\nimport { loadApplicationContext } from '../loaders';\nimport * as syncMigrations from '../migrations';\nimport { discardDocumentDrafts } from '../migrations/database/5.0.0-discard-drafts';\n\nexport default defineProvider({\n  init(strapi) {\n    strapi\n      .add('content-types', () => registries.contentTypes())\n      .add('components', () => registries.components())\n      .add('services', () => registries.services(strapi))\n      .add('policies', () => registries.policies())\n      .add('middlewares', () => registries.middlewares())\n      .add('hooks', () => registries.hooks())\n      .add('controllers', () => registries.controllers(strapi))\n      .add('modules', () => registries.modules(strapi))\n      .add('plugins', () => registries.plugins(strapi))\n      .add('custom-fields', () => registries.customFields(strapi))\n      .add('apis', () => registries.apis(strapi))\n      .add('models', () => registries.models())\n      .add('sanitizers', registries.sanitizers())\n      .add('validators', registries.validators());\n  },\n  async register(strapi) {\n    await loadApplicationContext(strapi);\n\n    strapi.get('hooks').set('strapi::content-types.beforeSync', hooks.createAsyncParallelHook());\n    strapi.get('hooks').set('strapi::content-types.afterSync', hooks.createAsyncParallelHook());\n\n    // Content migration to enable draft and publish\n    strapi.hook('strapi::content-types.beforeSync').register(syncMigrations.disable);\n    strapi.hook('strapi::content-types.afterSync').register(syncMigrations.enable);\n\n    // Database migrations\n    strapi.db.migrations.providers.internal.register(discardDocumentDrafts);\n  },\n});\n"],"names":["registries.contentTypes","registries.components","registries.services","registries.policies","registries.middlewares","registries.hooks","registries.controllers","registries.modules","registries.plugins","registries.customFields","registries.apis","registries.models","registries.sanitizers","registries.validators","syncMigrations.disable","syncMigrations.enable"],"mappings":";;;;;;;;;;;;;;;;;;;AAQA,MAAA,aAAe,eAAe;AAAA,EAC5B,KAAK,QAAQ;AAER,WAAA,IAAI,iBAAiB,MAAMA,qBAAyB,CAAA,EACpD,IAAI,cAAc,MAAMC,mBAAuB,CAAA,EAC/C,IAAI,YAAY,MAAMC,iBAAoB,MAAM,CAAC,EACjD,IAAI,YAAY,MAAMC,iBAAqB,CAAA,EAC3C,IAAI,eAAe,MAAMC,oBAAuB,CAAC,EACjD,IAAI,SAAS,MAAMC,eAAkB,EACrC,IAAI,eAAe,MAAMC,oBAAuB,MAAM,CAAC,EACvD,IAAI,WAAW,MAAMC,gBAAmB,MAAM,CAAC,EAC/C,IAAI,WAAW,MAAMC,gBAAmB,MAAM,CAAC,EAC/C,IAAI,iBAAiB,MAAMC,qBAAwB,MAAM,CAAC,EAC1D,IAAI,QAAQ,MAAMC,aAAgB,MAAM,CAAC,EACzC,IAAI,UAAU,MAAMC,SAAkB,CAAC,EACvC,IAAI,cAAcC,mBAAuB,CAAA,EACzC,IAAI,cAAcC,oBAAuB;AAAA,EAC9C;AAAA,EACA,MAAM,SAAS,QAAQ;AACrB,UAAM,uBAAuB,MAAM;AAEnC,WAAO,IAAI,OAAO,EAAE,IAAI,oCAAoC,MAAM,yBAAyB;AAC3F,WAAO,IAAI,OAAO,EAAE,IAAI,mCAAmC,MAAM,yBAAyB;AAG1F,WAAO,KAAK,kCAAkC,EAAE,SAASC,OAAsB;AAC/E,WAAO,KAAK,iCAAiC,EAAE,SAASC,MAAqB;AAG7E,WAAO,GAAG,WAAW,UAAU,SAAS,SAAS,qBAAqB;AAAA,EAAA;AAE1E,CAAC;"}