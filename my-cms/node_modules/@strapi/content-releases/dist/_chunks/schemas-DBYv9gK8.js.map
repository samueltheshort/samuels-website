{"version":3,"file":"schemas-DBYv9gK8.js","sources":["../../admin/src/validation/schemas.ts"],"sourcesContent":["import { translatedErrors } from '@strapi/admin/strapi-admin';\nimport { zonedTimeToUtc } from 'date-fns-tz';\nimport * as yup from 'yup';\n\n/**\n * FormikErrors type enforce us to always return a string as error.\n * We need these errors to be translated, so we need to create a hook to be able to use the formatMessage function.\n */\nexport const RELEASE_SCHEMA = yup\n  .object()\n  .shape({\n    name: yup.string().trim().required(translatedErrors.required.id).nullable(),\n    scheduledAt: yup.string().nullable(),\n    isScheduled: yup.boolean().optional(),\n    time: yup\n      .string()\n      .when('isScheduled', {\n        is: true,\n        then: yup.string().trim().required(translatedErrors.required.id),\n        otherwise: yup.string().nullable(),\n      })\n      .test(\n        'time-in-future-if-today',\n        'content-releases.modal.form.time.has-passed',\n        function (time) {\n          const { date, timezone } = this.parent;\n\n          if (!date || !timezone || !time) {\n            return true;\n          }\n\n          // Timezone is in format \"UTC&Europe/Paris\", so we get the region part for the dates functions\n          const region = timezone.split('&')[1];\n\n          const selectedTime = zonedTimeToUtc(`${date} ${time}`, region);\n          const now = new Date();\n\n          return selectedTime > now;\n        }\n      ),\n    timezone: yup.string().when('isScheduled', {\n      is: true,\n      then: yup.string().required(translatedErrors.required.id).nullable(),\n      otherwise: yup.string().nullable(),\n    }),\n    date: yup.string().when('isScheduled', {\n      is: true,\n      then: yup.string().required(translatedErrors.required.id).nullable(),\n      otherwise: yup.string().nullable(),\n    }),\n  })\n  .required()\n  .noUnknown();\n\nexport const SETTINGS_SCHEMA = yup\n  .object()\n  .shape({\n    defaultTimezone: yup.string().nullable().default(null),\n  })\n  .required()\n  .noUnknown();\n"],"names":["yup","translatedErrors","zonedTimeToUtc"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAQO,MAAM,iBAAiBA,eAC3B,OAAO,EACP,MAAM;AAAA,EACL,MAAMA,eAAI,OAAS,EAAA,KAAO,EAAA,SAASC,YAAAA,iBAAiB,SAAS,EAAE,EAAE,SAAS;AAAA,EAC1E,aAAaD,eAAI,OAAO,EAAE,SAAS;AAAA,EACnC,aAAaA,eAAI,QAAQ,EAAE,SAAS;AAAA,EACpC,MAAMA,eACH,SACA,KAAK,eAAe;AAAA,IACnB,IAAI;AAAA,IACJ,MAAMA,eAAI,SAAS,KAAO,EAAA,SAASC,YAAAA,iBAAiB,SAAS,EAAE;AAAA,IAC/D,WAAWD,eAAI,OAAO,EAAE,SAAS;AAAA,EAClC,CAAA,EACA;AAAA,IACC;AAAA,IACA;AAAA,IACA,SAAU,MAAM;AACd,YAAM,EAAE,MAAM,SAAS,IAAI,KAAK;AAEhC,UAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,MAAM;AACxB,eAAA;AAAA,MAAA;AAIT,YAAM,SAAS,SAAS,MAAM,GAAG,EAAE,CAAC;AAEpC,YAAM,eAAeE,UAAe,eAAA,GAAG,IAAI,IAAI,IAAI,IAAI,MAAM;AACvD,YAAA,0BAAU,KAAK;AAErB,aAAO,eAAe;AAAA,IAAA;AAAA,EAE1B;AAAA,EACF,UAAUF,eAAI,SAAS,KAAK,eAAe;AAAA,IACzC,IAAI;AAAA,IACJ,MAAMA,eAAI,SAAS,SAASC,YAAAA,iBAAiB,SAAS,EAAE,EAAE,SAAS;AAAA,IACnE,WAAWD,eAAI,OAAO,EAAE,SAAS;AAAA,EAAA,CAClC;AAAA,EACD,MAAMA,eAAI,SAAS,KAAK,eAAe;AAAA,IACrC,IAAI;AAAA,IACJ,MAAMA,eAAI,SAAS,SAASC,YAAAA,iBAAiB,SAAS,EAAE,EAAE,SAAS;AAAA,IACnE,WAAWD,eAAI,OAAO,EAAE,SAAS;AAAA,EAClC,CAAA;AACH,CAAC,EACA,SAAS,EACT,UAAU;AAEN,MAAM,kBAAkBA,eAC5B,OAAO,EACP,MAAM;AAAA,EACL,iBAAiBA,eAAI,OAAA,EAAS,SAAS,EAAE,QAAQ,IAAI;AACvD,CAAC,EACA,SAAS,EACT,UAAU;;;"}