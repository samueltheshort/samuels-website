{"version":3,"file":"index.js","sources":["../../src/cli/index.ts"],"sourcesContent":["import { Command } from 'commander';\n\nimport { commands as strapiCommands } from './commands';\n\nimport { createLogger } from './utils/logger';\nimport { loadTsConfig } from './utils/tsconfig';\nimport { CLIContext } from './types';\n\nconst createCLI = async (argv: string[], command = new Command()) => {\n  // Initial program setup\n  command.storeOptionsAsProperties(false).allowUnknownOption(true);\n\n  // Help command\n  command.helpOption('-h, --help', 'Display help for command');\n  command.addHelpCommand('help [command]', 'Display help for command');\n\n  command.version(\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    require('../../package.json').version,\n    '-v, --version',\n    'Output the version number'\n  );\n\n  const cwd = process.cwd();\n\n  const hasDebug = argv.includes('--debug');\n  const hasSilent = argv.includes('--silent');\n\n  const logger = createLogger({ debug: hasDebug, silent: hasSilent, timestamp: false });\n\n  const tsconfig = loadTsConfig({\n    cwd,\n    path: 'tsconfig.json',\n    logger,\n  });\n\n  const ctx = {\n    cwd,\n    logger,\n    tsconfig,\n  } satisfies CLIContext;\n\n  // Load all commands\n  for (const commandFactory of strapiCommands) {\n    try {\n      const subCommand = await commandFactory({ command, argv, ctx });\n\n      // Add this command to the Commander command object\n      if (subCommand) {\n        command.addCommand(subCommand);\n      }\n    } catch (e) {\n      console.error(`Failed to load command`, e);\n    }\n  }\n\n  // TODO v6: remove these deprecation notices\n  const deprecatedCommands = [\n    { name: 'plugin:init', message: 'Please use `npx @strapi/sdk-plugin init` instead.' },\n    {\n      name: 'plugin:verify',\n      message: 'After migrating your plugin to v5, use `strapi-plugin verify`',\n    },\n    {\n      name: 'plugin:watch',\n      message: 'After migrating your plugin to v5, use `strapi-plugin watch`',\n    },\n    {\n      name: 'plugin:watch:link',\n      message: 'After migrating your plugin to v5, use `strapi-plugin watch:link`',\n    },\n    {\n      name: 'plugin:build',\n      message: 'After migrating your plugin to v5, use `strapi-plugin build`',\n    },\n  ];\n\n  // Add hidden commands for deprecatedCommands that output a warning that the command has been removed.\n  deprecatedCommands.forEach(({ name, message }) => {\n    const deprecated = new Command(name)\n      .command(name)\n      .description('(deprecated)')\n      .action(() => {\n        console.warn(\n          `The command ${name} has been deprecated. See the Strapi 5 migration guide for more information.`\n        );\n        if (message) {\n          console.warn(message);\n        }\n      });\n    command.addCommand(deprecated, { hidden: true });\n  });\n  return command;\n};\n\nconst runCLI = async (argv = process.argv, command = new Command()) => {\n  const commands = await createCLI(argv, command);\n  await commands.parseAsync(argv);\n};\n\nexport { runCLI, createCLI };\n"],"names":["Command","logger","createLogger","tsconfig","loadTsConfig","strapiCommands"],"mappings":";;;;;;AAQA,MAAM,YAAY,OAAO,MAAgB,UAAU,IAAIA,wBAAc;AAEnE,UAAQ,yBAAyB,KAAK,EAAE,mBAAmB,IAAI;AAGvD,UAAA,WAAW,cAAc,0BAA0B;AACnD,UAAA,eAAe,kBAAkB,0BAA0B;AAE3D,UAAA;AAAA;AAAA,IAEN,QAAQ,oBAAoB,EAAE;AAAA,IAC9B;AAAA,IACA;AAAA,EACF;AAEM,QAAA,MAAM,QAAQ,IAAI;AAElB,QAAA,WAAW,KAAK,SAAS,SAAS;AAClC,QAAA,YAAY,KAAK,SAAS,UAAU;AAEpC,QAAAC,WAASC,oBAAa,EAAE,OAAO,UAAU,QAAQ,WAAW,WAAW,OAAO;AAEpF,QAAMC,aAAWC,SAAAA,aAAa;AAAA,IAC5B;AAAA,IACA,MAAM;AAAA,IACNH,QAAAA;AAAAA,EAAA,CACD;AAED,QAAM,MAAM;AAAA,IACV;AAAA,IAAA,QACAA;AAAAA,IACAE,UAAAA;AAAAA,EACF;AAGA,aAAW,kBAAkBE,gBAAgB;AACvC,QAAA;AACF,YAAM,aAAa,MAAM,eAAe,EAAE,SAAS,MAAM,KAAK;AAG9D,UAAI,YAAY;AACd,gBAAQ,WAAW,UAAU;AAAA,MAAA;AAAA,aAExB,GAAG;AACF,cAAA,MAAM,0BAA0B,CAAC;AAAA,IAAA;AAAA,EAC3C;AAIF,QAAM,qBAAqB;AAAA,IACzB,EAAE,MAAM,eAAe,SAAS,oDAAoD;AAAA,IACpF;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,SAAS;AAAA,IAAA;AAAA,EAEb;AAGA,qBAAmB,QAAQ,CAAC,EAAE,MAAM,cAAc;AAChD,UAAM,aAAa,IAAIL,kBAAQ,IAAI,EAChC,QAAQ,IAAI,EACZ,YAAY,cAAc,EAC1B,OAAO,MAAM;AACJ,cAAA;AAAA,QACN,eAAe,IAAI;AAAA,MACrB;AACA,UAAI,SAAS;AACX,gBAAQ,KAAK,OAAO;AAAA,MAAA;AAAA,IACtB,CACD;AACH,YAAQ,WAAW,YAAY,EAAE,QAAQ,MAAM;AAAA,EAAA,CAChD;AACM,SAAA;AACT;AAEM,MAAA,SAAS,OAAO,OAAO,QAAQ,MAAM,UAAU,IAAIA,UAAAA,cAAc;AACrE,QAAM,WAAW,MAAM,UAAU,MAAM,OAAO;AACxC,QAAA,SAAS,WAAW,IAAI;AAChC;;;"}